<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IDE 連結攔截器 - 測試頁面</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    h1, h2, h3 { color: #569cd6; }
    .section {
      background: #252526;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .test-link {
      display: block;
      background: #0e639c;
      color: white;
      padding: 12px 20px;
      margin: 10px 0;
      text-decoration: none;
      border-radius: 4px;
      font-size: 14px;
    }
    .test-link:hover { background: #1177bb; }
    .test-link code {
      background: rgba(0,0,0,0.3);
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
    }
    .description {
      color: #9cdcfe;
      font-size: 13px;
      margin-top: 5px;
    }
    .warning {
      background: #4d3d00;
      border-left: 4px solid #ffcc00;
      padding: 10px 15px;
      margin: 15px 0;
    }
    .success {
      background: #1d3d1d;
      border-left: 4px solid #4ec9b0;
      padding: 10px 15px;
      margin: 15px 0;
    }
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 12px 20px;
      margin: 10px 5px 10px 0;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover { background: #1177bb; }
    #result {
      background: #1e1e1e;
      border: 1px solid #3c3c3c;
      padding: 15px;
      margin-top: 15px;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
      min-height: 100px;
    }
    .language-toggle {
      text-align: right;
      margin-bottom: 10px;
    }
    .language-toggle a {
      color: #569cd6;
      text-decoration: none;
      font-size: 14px;
    }
    .language-toggle a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="language-toggle">
    <a href="test-links.html">English Version / 英文版</a>
  </div>

  <h1>IDE 連結攔截器 - 測試頁面</h1>
  
  <div class="warning">
    <strong>使用說明：</strong>
    <ol>
      <li>開啟 Chrome 開發者工具（F12）並切換到主控台分頁</li>
      <li>點擊擴充功能圖示並選擇你的目標 IDE（例如：Antigravity）</li>
      <li>點擊下方的每個測試連結並觀察主控台日誌</li>
      <li>尋找顯示 URL 轉換的 <code>[IDE Switcher]</code> 訊息</li>
    </ol>
  </div>

  <div class="section">
    <h2>1. 擴充功能安裝連結 (vscode:extension/...)</h2>
    <p class="description">這些連結應該在你的目標 IDE 中開啟擴充功能頁面。這些是來自 VS Code Marketplace 等擴充功能提供網站的連結。</p>
    
    <a href="vscode:extension/ms-python.python" class="test-link">
      Python 擴充功能 <code>vscode:extension/ms-python.python</code>
      <div class="description">來自 VS Code Marketplace 的 Python 語言支援擴充功能</div>
    </a>
    
    <a href="vscode:extension/esbenp.prettier-vscode" class="test-link">
      Prettier 擴充功能 <code>vscode:extension/esbenp.prettier-vscode</code>
      <div class="description">來自 VS Code Marketplace 的程式碼格式化工具擴充功能</div>
    </a>
    
    <a href="vscode-insiders:extension/GitHub.copilot" class="test-link">
      GitHub Copilot <code>vscode-insiders:extension/GitHub.copilot</code>
      <div class="description">來自 VS Code Marketplace 的 AI 程式設計助手擴充功能</div>
    </a>
  </div>

  <div class="section">
    <h2>2. 檔案開啟連結 (vscode://file/...)</h2>
    <p class="description">這些連結應該在你的目標 IDE 中開啟檔案。</p>
    
    <a href="vscode://file/C:/test/example.py:10:5" class="test-link">
      開啟檔案（Windows）<code>vscode://file/C:/test/example.py:10:5</code>
      <div class="description">在第 10 行第 5 列開啟 Windows 路徑的檔案</div>
    </a>
    
    <a href="vscode://file//home/user/project/main.py" class="test-link">
      開啟檔案（Linux）<code>vscode://file//home/user/project/main.py</code>
      <div class="description">開啟 Linux 路徑的檔案</div>
    </a>
  </div>

  <div class="section">
    <h2>3. MCP 安裝連結</h2>
    <p class="description">這些連結應該觸發 MCP 伺服器安裝。</p>
    
    <a href="vscode:mcp/install?%7B%22name%22%3A%22test-server%22%2C%22type%22%3A%22http%22%2C%22url%22%3A%22https%3A%2F%2Fexample.com%2Fmcp%22%7D" class="test-link">
      MCP HTTP 伺服器 <code>vscode:mcp/install?{...}</code>
      <div class="description">測試 MCP 伺服器安裝連結重新導向</div>
    </a>
  </div>

  <div class="section">
    <h2>4. JavaScript 導航測試</h2>
    <p class="description">測試 JavaScript 觸發的導航（interceptor.js）。</p>
    
    <button onclick="testLocationHref()">測試 location.href</button>
    <button onclick="testLocationAssign()">測試 location.assign()</button>
    <button onclick="testWindowOpen()">測試 window.open()</button>
    
    <div id="result">點擊按鈕測試 JavaScript 導航...</div>
  </div>

  <div class="section">
    <h2>5. 預期的 URL 轉換</h2>
    <table style="width: 100%; border-collapse: collapse;">
      <tr style="background: #3c3c3c;">
        <th style="padding: 10px; text-align: left;">目標 IDE</th>
        <th style="padding: 10px; text-align: left;">輸入</th>
        <th style="padding: 10px; text-align: left;">預期輸出</th>
      </tr>
      <tr>
        <td style="padding: 10px;">Antigravity</td>
        <td style="padding: 10px;"><code>vscode:extension/ms-python.python</code></td>
        <td style="padding: 10px;"><code>antigravity://extension/ms-python.python</code></td>
      </tr>
      <tr style="background: #2d2d2d;">
        <td style="padding: 10px;">Cursor</td>
        <td style="padding: 10px;"><code>vscode:extension/ms-python.python</code></td>
        <td style="padding: 10px;"><code>cursor:extension/ms-python.python</code></td>
      </tr>
      <tr>
        <td style="padding: 10px;">VS Code</td>
        <td style="padding: 10px;"><code>cursor:extension/ms-python.python</code></td>
        <td style="padding: 10px;"><code>vscode:extension/ms-python.python</code></td>
      </tr>
      <tr style="background: #2d2d2d;">
        <td style="padding: 10px;">Antigravity</td>
        <td style="padding: 10px;"><code>vscode://file/path</code></td>
        <td style="padding: 10px;"><code>antigravity://file/path</code></td>
      </tr>
    </table>
  </div>

  <div class="success">
    <strong>檢查項目：</strong>
    <ul>
      <li>主控台顯示 <code>[IDE Switcher] 攔截擴充連結: ...</code></li>
      <li>主控台顯示 <code>[IDE Switcher] 重定向至: antigravity://...</code>（針對 Antigravity）</li>
      <li>你的 IDE 應該啟動並開啟擴充功能頁面</li>
    </ul>
  </div>

  <script>
    function testLocationHref() {
      const url = 'vscode:extension/ms-python.python';
      document.getElementById('result').textContent = 
        `測試中: window.location.href = "${url}"\n\n請檢查主控台的 [IDE Switcher] 日誌...`;
      
      // Slight delay to show the message
      setTimeout(() => {
        window.location.href = url;
      }, 500);
    }

    function testLocationAssign() {
      const url = 'vscode:extension/esbenp.prettier-vscode';
      document.getElementById('result').textContent = 
        `測試中: window.location.assign("${url}")\n\n請檢查主控台的 [IDE Switcher] 日誌...`;
      
      setTimeout(() => {
        window.location.assign(url);
      }, 500);
    }

    function testWindowOpen() {
      const url = 'vscode://file/C:/test/example.py';
      document.getElementById('result').textContent = 
        `測試中: window.open("${url}")\n\n請檢查主控台的 [IDE Switcher] 日誌...\n\n（注意：這可能會被彈出視窗攔截器阻擋）`;
      
      setTimeout(() => {
        window.open(url);
      }, 500);
    }
  </script>
</body>
</html>
